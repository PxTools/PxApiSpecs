openapi: '3.0.2'
info:
  title: PxApi
  version: '2.0'
servers:
  - url: https://api.server.test/v1
paths:
  /navigation:
      get:
        tags:
          - Navigation
        summary: Browse the database structure
        operationId: GetNavigationRoot
        parameters:
          - $ref: '#/components/parameters/language'
        responses:
          '200':
            description: Success
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/NavigationItem'
                examples:
                  NavigateRoot:
                    $ref: '#/components/examples/navigation-root'
          '429':
            $ref: '#/components/responses/ErrorResponse429'
  /navigation/{id}:
    get:
      tags:
        - Navigation
      summary: Gets navigation item with the given id.
      operationId: GetNavigationById
      parameters:
        - $ref: '#/components/parameters/id'
        - $ref: '#/components/parameters/language'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NavigationItem'
              examples:
                  Navigation-BE:
                    $ref: '#/components/examples/navigation-be'
components:
  parameters:
    language:
      name: lang
      in: query
      description: The language if the default is not what you want.
      required: false
      schema:
        type: string
      examples:
        X1:
          value: en
          summary: For english
        X2:
          value: dk
          summary: For danish
    id:
      name: id
      in: path
      description: Id
      required: true
      schema:
        type: string
  schemas:
    NavigationItem:
      type: object
      description: Navigation item.
      properties:
        id:
          type: string
          nullable: true
          #nullable = true beacause root is empty
        objectType:
          type: string
          nullable: false
          description: One of heading, table, folder or folder-information
        label:
          type: string
          nullable: true
          description: Display text
        description:
          type: string
          nullable: true
          description: Longer text describing node.
    Folder:
      allOf:
        - $ref: '#/components/schemas/NavigationItem'
        - type: object
          description: Folder item
          properties:
            tags:
              type: array
              items:
                type: string
                description: tag for folder
              nullable: true
            folderContents:
              type: array
              items:
                $ref: '#/components/schemas/NavigationItem'
              nullable: true
            links:
              type: array
              items:
                $ref: '#/components/schemas/Link'
              description: Links to ...
              nullable: true
    FolderInformation:
      allOf:
        - $ref: '#/components/schemas/NavigationItem'
        - type: object
          description: Folder information item
          properties:
            tags:
              type: array
              items:
                type: string
                description: tag for folder
              nullable: true
            links:
              type: array
              items:
                $ref: '#/components/schemas/Link'
              description: Links to ...
              nullable: true
    Heading:
      allOf:
        - $ref: '#/components/schemas/NavigationItem'
        - type: object
          description: Heading item
    Table:
      allOf:
        - $ref: '#/components/schemas/NavigationItem'
        - type: object
          description: Table item
          properties:
            tags:
              type: array
              items:
                type: string
                description: tag for table
              nullable: true
            updated:
              type: string
              description: For treeNodeType "table"
              format: date-time
              nullable: true
            category:
              type: string
              description: Mostly for internal use. Which category table belongs to. internal, official, private or section. I, O, P, S
              default: official
              enum:
              - internal
              - official
              - private
              - section
            links:
              type: array
              items:
                $ref: '#/components/schemas/Link'
              description: Links to ...
              nullable: true
    Link:
      type: object
      properties:
        rel:
          type: string
          nullable: false
        href:
          type: string
          nullable: false
      additionalProperties: false
      required:
        - rel
        - href
    Problem:
      type: object
      properties:
        type:
          type: string
          format: uri
          description: |
            An absolute URI that identifies the problem type.  When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: about:blank
          example: https://zalando.github.io/problem/constraint-violation
        title:
          type: string
          description: |
            A short, summary of the problem type. Written in english and readable
            for engineers (usually not suited for non technical stakeholders and
            not localized); example: Service Unavailable
        status:
          type: integer
          format: int32
          description: |
            The HTTP status code generated by the origin server for this occurrence
            of the problem.
          minimum: 100
          maximum: 600
          exclusiveMaximum: true
          example: 503
        detail:
          type: string
          description: |
            A human readable explanation specific to this occurrence of the
            problem.
          example: Connection to database timed out
        instance:
          type: string
          format: uri
          description: |
            An absolute URI that identifies the specific occurrence of the problem.
            It may or may not yield further information if dereferenced.
  responses:
    ErrorResponse429:
      description: Error respsone for 429
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/Problem'
            #Reference: 
            # https://dzone.com/articles/rest-api-error-handling-problem-details-response
            # https://datatracker.ietf.org/doc/html/rfc7807
            # https://nordicapis.com/best-practices-api-error-handling/
          example:
            title: Too many requests
            status: 429
            detail: You have reach the threshold for request limiting. 30 request per minute.
  examples:  
    navigation-root:
      description: Example for 200 response for navigation endpoint
      value:
        id: 
        objectType: folder
        label: 
        description:
        links:
        - rel: self
          href: https://my-site.com/api/v2/navigation
        folderContents:
        - id: AM
          objectType: folder
          label: Arbetsmarknad
          description: Beskrivning av arbetsmarknad
          links:
          - rel: self
            href: https://my-site.com/api/v2/navigation/AM
        - id: BE
          objectType: folder
          label: Befolkning
          description: Folkmängd, in- och utvanding, medellivslängd, namn, prognoser mm
          links:
          - rel: self
            href: https://my-site.com/api/v2/navigation/BE

    navigation-be:
      description: Example for 200 response for navigation endpoint
      value:
        id: BE
        objectType: folder
        label: Befolkning
        description: Folkmängd, in- och utvanding, medellivslängd, namn, prognoser mm
        links:
        - rel: self
          href: https://my-site.com/api/v2/navigation/BE
        folderContents:
        - id: BE0101
          objectType: folder-information
          label: Befolkningsstatistik
          description: Folkmängd, in- och utvanding, medellivslängd, namn, prognoser mm
          links:
          - rel: folder
            href: https://my-site.com/api/v2/navigation/BE0101
        - id: BE0401
          objectType: folder-information
          label: Befolkningsframskrivningar
          description: Folkmängd, in- och utvanding, medellivslängd, namn, prognoser mm
          links:
          - rel: folder
            href: https://my-site.com/api/v2/navigation/BE0401
        - id: BEH1
          objectType: heading
          label: Intressanta siffror
          description: XYZ
        - id: TAB0001
          objectType: table
          label: Tabell A
          description: Folkmängd, in- och utvanding, medellivslängd, namn, prognoser mm
          updated: ''
          categoy: ''
          tags: []
          links:
          - rel: self
            href: https://my-site.com/api/v2/tables/TAB0001
          - rel: metadata
            href: https://my-site.com/api/v2/tables/TAB0001/metadata
          - rel: data
            href: https://my-site.com/api/v2/tables/TAB0001/data

